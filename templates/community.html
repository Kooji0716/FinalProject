{% extends "base.html" %}

{% block content %}
<div class="got-container">

    <h1 class="got-title">ğŸ¬ MovieHub ç¤¾ç¾¤</h1>

    <!-- ç™¼æ–‡å€ -->
    {% if session.get('username') %}
        <form method="POST" style="margin-bottom: 30px;">
            <!-- æ¨™é¡Œ -->
            <input
                type="text"
                name="title"
                placeholder="è²¼æ–‡æ¨™é¡Œ"
                required
                style="width: 100%; padding: 10px; margin-bottom: 10px;"
            >

            <!-- å…§å®¹ -->
            <textarea
                name="content"
                rows="5"
                placeholder="åˆ†äº«ä½ çš„é›»å½±å¿ƒå¾—æˆ–æ˜æ˜Ÿå…«å¦..."
                required
                style="width: 100%; padding: 10px;"
            ></textarea>

            <button type="submit" style="margin-top: 10px;">
                ç™¼è¡¨è²¼æ–‡
            </button>
        </form>
    {% else %}
        <p style="color:red; font-weight:bold;">
            å°šæœªç™»å…¥ï¼Œ<a href="{{ url_for('login') }}">ç™»å…¥å¾Œå³å¯ç™¼æ–‡</a>
        </p>
    {% endif %}

    <hr>

<!-- è²¼æ–‡åˆ—è¡¨ -->
{% for post in posts %}
    <div class="comment-item" style="margin-bottom: 30px;">
        <h3>{{ post['title'] }}</h3>

        <pre style="font-family: monospace; white-space: pre-wrap; margin-bottom: 10px;">
{{- post['content'][:200] -}}{% if post['content']|length > 200 %}...{% endif %}</pre>

        <small style="color: #555;">
            ğŸ‘¤ {{ post['username'] }} ï½œ {{ post['timestamp'] }}
        </small>
        <br>

        <a href="{{ url_for('community_post', post_id=post['id']) }}">
            ğŸ‘‰ æŸ¥çœ‹ç•™è¨€èˆ‡å›è¦†
        </a>

        <!--åªæœ‰åŸä½œè€…æ‰èƒ½çœ‹åˆ°åˆªé™¤æŒ‰éˆ• -->
        {% if session.get('username') == post['username'] %}
            <form method="POST"
                  action="{{ url_for('delete_community_post', post_id=post['id']) }}"
                  style="display:inline;">
                <button type="submit"
                        style="margin-left: 10px; color: red;"
                        onclick="return confirm('ä½ ç¢ºå®šè¦åˆªé™¤æ­¤è²¼æ–‡å—ï¼Ÿ')">
                    ğŸ—‘ åˆªé™¤è²¼æ–‡
                </button>
            </form>
        {% endif %}
    </div>
{% else %}
    <p>ç›®å‰é‚„æ²’æœ‰è²¼æ–‡ï¼Œæˆç‚ºç¬¬ä¸€å€‹ç™¼æ–‡çš„äººå§ï¼</p>
{% endfor %}


</div>
{% endblock %}
