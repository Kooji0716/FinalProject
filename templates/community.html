{% extends "base.html" %}

{% block content %}
<div class="got-container">

    <h1 class="got-title">ğŸ¬ MovieHub ç¤¾ç¾¤</h1>

    <!-- ç™¼æ–‡å€ -->
    {% if session.get('username') %}
        <form method="POST" style="margin-bottom: 30px;">
            <!-- æ¨™é¡Œ -->
            <input
                type="text"
                name="title"
                placeholder="è²¼æ–‡æ¨™é¡Œ"
                required
                style="width: 100%; padding: 10px; margin-bottom: 10px;"
            >

            <!-- å…§å®¹ -->
            <textarea
                name="content"
                rows="5"
                placeholder="åˆ†äº«ä½ çš„é›»å½±å¿ƒå¾—æˆ–æ˜æ˜Ÿå…«å¦..."
                required
                style="width: 100%; padding: 10px;"
            ></textarea>

            <button type="submit" style="margin-top: 10px;">
                ç™¼è¡¨è²¼æ–‡
            </button>
        </form>
    {% else %}
        <p style="color:red; font-weight:bold;">
            å°šæœªç™»å…¥ï¼Œ<a href="{{ url_for('login') }}">ç™»å…¥å¾Œå³å¯ç™¼æ–‡</a>
        </p>
    {% endif %}

    <hr>

    <!-- è²¼æ–‡åˆ—è¡¨ -->
    {% for post in posts %}
        <div class="comment-item" style="margin-bottom: 30px;">
            <h3>{{ post['title'] }}</h3>

            <!-- âœ… é¡¯ç¤ºå‰ 200 å­—ï¼Œä¿ç•™ç©ºç™½èˆ‡æ›è¡Œ -->
            <pre style="font-family: monospace; white-space: pre-wrap; margin-bottom: 10px;">{{- post['content'][:200] -}}{% if post['content']|length > 200 %}...{% endif %}</pre>

            <small style="color: #555;">
                ğŸ‘¤ {{ post['username'] }} ï½œ {{ post['timestamp'] }}
            </small>
            <br>
            <a href="{{ url_for('community_post', post_id=post['id']) }}">
                ğŸ‘‰ æŸ¥çœ‹ç•™è¨€èˆ‡å›è¦†
            </a>
        </div>
    {% else %}
        <p>ç›®å‰é‚„æ²’æœ‰è²¼æ–‡ï¼Œæˆç‚ºç¬¬ä¸€å€‹ç™¼æ–‡çš„äººå§ï¼</p>
    {% endfor %}

</div>
{% endblock %}
